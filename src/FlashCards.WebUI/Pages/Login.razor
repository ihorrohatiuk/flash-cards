@page "/Login"
@using FlashCards.Core.Application.Dtos
@using FlashCards.Infrastructure.Services

@inject NavigationManager NavigationManager
@inject IAuthenticationService AuthenticationService
@*TODO: remove footer from this page*@
@*TODO: remove navbar and navbar button from this page*@

<MudPaper Elevation="4" Style="max-width: 400px;
    margin: 100px auto;
    padding: 30px;
    display: flex;
    flex-direction: column;
    gap: 16px;">
    <MudText Typo="Typo.h4" Align="Align.Center">Log in</MudText>

    <MudForm Valid="_isValid">
        <MudTextField @bind-Value="_loginRequestDto.Email" Label="Email" Required="true" RequiredError="Email is required" />
        <MudTextField @bind-Value="_loginRequestDto.Password" Label="Password" Required="true" InputType="InputType.Password" 
                      RequiredError="Password is required" />

        <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="SubmitAsync" 
                   Style="margin-top: 30px">Login</MudButton>
    </MudForm>

    @if (_errorMessage != null)
    {
        <MudAlert Severity="Severity.Error">@_errorMessage</MudAlert>
    }
</MudPaper>

@code {
    private bool _isValid = false;
    private bool _isLoginSuccess = false;
    private string? _errorMessage = null!;

    private LoginRequestDto _loginRequestDto = new();

    private async Task SubmitAsync()
    {
        try
        {
            _isLoginSuccess = await AuthenticationService.LoginAsync(_loginRequestDto);
            _errorMessage = null;
            
            if (_isLoginSuccess)
                NavigationManager.NavigateTo("/", true);
            
            StateHasChanged();
        }
        catch (Exception e)
        {
            _errorMessage = e.Message;
        }
    }
}